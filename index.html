<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Team Customer Tracker</title>
<meta name="theme-color" content="#0a2a43"/>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<!-- QR Scanner -->
<script src="https://unpkg.com/html5-qrcode"></script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body { margin:0; font-family:"Segoe UI", sans-serif; background:#0a2a43; color:#fff; }
header { text-align:center; font-size:1.4rem; font-weight:bold; padding:15px; background:linear-gradient(90deg,#0d3d66,#0a2a43); }
.container { padding:20px; max-width:400px; margin:auto; }
input, select, button { width:100%; padding:10px; margin:6px 0; border-radius:6px; border:none; font-size:1rem; }
button { background:#1a73e8; color:#fff; cursor:pointer; font-weight:bold; }
table { width:100%; margin-top:15px; border-collapse:collapse; }
th, td { padding:8px; border:1px solid #fff; text-align:left; }
th { background:#1a73e8; }
#qr-reader { display:none; height:2rem; }
.splash {
  position:fixed; top:0; left:0; right:0; bottom:0;
  background:#0a2a43; display:flex; align-items:center; justify-content:center; flex-direction:column;
  z-index:1000; color:#fff; font-size:2rem; animation:fadeout 1.2s ease 2.5s forwards;
}
@keyframes fadeout { to { opacity:0; visibility:hidden; } }
.flame { position:absolute; width:8px; height:8px; background:#1a73e8; border-radius:50%; animation:fly 3s infinite linear; }
@keyframes fly { from { transform: translateY(0) scale(1); opacity:1; } to { transform: translateY(-200px) scale(0.3); opacity:0; } }
</style>
</head>
<body>

<!-- Splash screen -->
<div class="splash">
  <div style="font-size:3rem; font-weight:bold;"> KAYIZZIâ€™S </div>
  <div style="margin-top:12px; font-size:1.2rem;">Customer Tracker</div>
  <div class="flame" style="left:40%; animation-delay:0s;"></div>
  <div class="flame" style="left:50%; animation-delay:0.5s;"></div>
  <div class="flame" style="left:60%; animation-delay:2s;"></div>
</div>

<header>ðŸ“Š Customer Data </header>

<!-- Login -->
<div class="container" id="login-container">
<h2>Login</h2>
<input type="email" id="login-email" placeholder="Email"/>
<input type="password" id="login-password" placeholder="Password"/>
<button onclick="login()">Login</button>
<button onclick="signup()">Sign Up</button>
</div>

<!-- App -->
<div class="container" id="app-container" style="display:none;">
<label>Customer Name</label>
<input type="text" id="custName" placeholder="Enter customer name"/>

<label>MTN Number</label>
<input type="number" id="custNumber" placeholder="10-digit MTN number"/>

<label>IMEI</label>
<input type="text" id="custIMEI" placeholder="Scan or enter IMEI" maxlength="14" style="height:2rem; font-size:1rem;"/>
<button onclick="startScanner()">ðŸ“· Scan</button>
<div id="qr-reader"></div>

<label>Date</label>
<input type="date" id="custDate"/>

<label>Got Data ?</label>
<select id="custOffer">
<option value="Yes">Yes</option>
<option value="No">No</option>
</select>

<button onclick="addEntry()">âž• Add Entry</button>
<button onclick="exportPDF()">ðŸ“‘ Export PDF</button>
<button onclick="clearData()">ðŸ—‘ Clear Data</button>
<button onclick="logout()">Logout</button>

<label>Filter by Name/Number</label>
<input type="text" id="filterBox" onkeyup="filterTable()" placeholder="Type to filter..."/>

<table id="dataTable">
<thead><tr><th>Name</th><th>Number</th><th>IMEI</th><th>Date</th><th>Data</th><th>Promoter</th></tr></thead>
<tbody></tbody>
</table>
</div>

<script>
// ===== Firebase Config =====
const firebaseConfig = {
  apiKey: "AIzaSyCQyyaaoa-QIjPQ9UfHJXEwWAfCKPKc-u0",
  authDomain: "customer-follow-up-7ab17.firebaseapp.com",
  projectId: "customer-follow-up-7ab17",
  storageBucket: "customer-follow-up-7ab17.firebasestorage.app",
  messagingSenderId: "350957822054",
  appId: "1:350957822054:web:c5a3aca9deacebbe050da7",
  measurementId: "G-08FJBE5F17"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ===== Login/Signup =====
function login() {
  const email=document.getElementById("login-email").value;
  const pass=document.getElementById("login-password").value;
  auth.signInWithEmailAndPassword(email,pass).then(()=>initApp()).catch(e=>alert(e.message));
}
function signup() {
  const email=document.getElementById("login-email").value;
  const pass=document.getElementById("login-password").value;
  auth.createUserWithEmailAndPassword(email,pass).then(()=>initApp()).catch(e=>alert(e.message));
}
function logout() { auth.signOut().then(()=>location.reload()); }

// ===== Initialize App =====
function initApp(){
  document.getElementById("login-container").style.display="none";
  document.getElementById("app-container").style.display="block";
  loadEntries();
}

// ===== Add Entry =====
function addEntry(){
  const name=document.getElementById("custName").value.trim();
  const number=document.getElementById("custNumber").value.trim();
  const imei=document.getElementById("custIMEI").value.trim();
  const date=document.getElementById("custDate").value;
  const offer=document.getElementById("custOffer").value;
  if(!name||!number||number.length!==10){ alert("Enter valid data."); return; }
  const promoter=auth.currentUser.email;
  db.collection("customers").add({name,number,imei,date,offer,promoter})
  .then(()=>{ 
    document.getElementById("custName").value="";
    document.getElementById("custNumber").value="";
    document.getElementById("custIMEI").value="";
    document.getElementById("custDate").value="";
  }).catch(e=>console.log(e));
}

// ===== Load Entries =====
function loadEntries(){
  const tbody=document.querySelector("#dataTable tbody");
  tbody.innerHTML="";
  db.collection("customers").orderBy("date","desc")
  .onSnapshot(snapshot=>{
    tbody.innerHTML="";
    snapshot.forEach(doc=>{
      const data=doc.data();
      const row=`<tr>
        <td>${data.name}</td>
        <td>${data.number}</td>
        <td>${data.imei}</td>
        <td>${data.date}</td>
        <td>${data.offer}</td>
        <td>${data.promoter}</td>
      </tr>`;
      tbody.insertAdjacentHTML("beforeend",row);
    });
  });
}

// ===== QR Scanner =====
function startScanner(){
  const html5QrCode=new Html5Qrcode("custIMEI"); 
  html5QrCode.start(
    {facingMode:"environment"},
    {fps:10, qrbox:{width:1,height:1}},
    qrCodeMessage=>{
      document.getElementById("custIMEI").value=qrCodeMessage.slice(0,14);
      html5QrCode.stop();
    },
    errorMessage=>{ console.log(errorMessage); }
  );
}

// ===== Export PDF =====
async function exportPDF(){
  const { jsPDF }=window.jspdf;
  const doc=new jsPDF();
  doc.text("Customer Data",20,20);
  let y=30;
  document.querySelectorAll("#dataTable tbody tr").forEach(tr=>{
    let row=[...tr.children].map(td=>td.innerText).join(" | ");
    doc.text(row,20,y); y+=10;
  });
  doc.save("customers.pdf");
}

// ===== Clear Data =====
function clearData(){
  if(confirm("Are you sure you want to delete all customer data? This cannot be undone.")){
    db.collection("customers").get().then(snapshot=>{
      snapshot.forEach(doc=>{ db.collection("customers").doc(doc.id).delete(); });
    });
  }
}

// ===== Filter Table =====
function filterTable(){
  const q=document.getElementById("filterBox").value.toLowerCase();
  document.querySelectorAll("#dataTable tbody tr").forEach(tr=>{
    tr.style.display=tr.innerText.toLowerCase().includes(q)?"":"none";
  });
}
</script>

</body>
</html>